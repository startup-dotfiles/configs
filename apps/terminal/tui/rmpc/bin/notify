#!/usr/bin/env bash

# Desktop notification on song change
## https://mierak.github.io/rmpc/next/guides/on_song_change/#desktop-notification-on-song-change
## Requirements:
## - notify-send (or others)

# Directory where to store temporary data
TMP_DIR="/tmp/rmpc"

# Ensure the directory is created
mkdir -p "$TMP_DIR"

# Where to temporarily store the album art received from rmpc
ALBUM_ART_PATH="$TMP_DIR/notification_cover"

# Path to fallback album art if no album art is found by rmpc/mpd
# Change this to your needs.
DEFAULT_ALBUM_ART_PATH="$HOME/.config/rmpc/assets/default_album_art.png"

# Save album art of the currently playing song to a file
if ! rmpc albumart --output "$ALBUM_ART_PATH"; then
    # Use default album art if rmpc returns non-zero exit code
    ALBUM_ART_PATH="${DEFAULT_ALBUM_ART_PATH}"
fi

# Send the notification
## TODO: [Customizable] Maybe switch to a different notification program, such as `mako` or `swaync`.
notify-send -i "${ALBUM_ART_PATH}" "Now Playing" "$ARTIST - $TITLE"
